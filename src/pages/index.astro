---
import Layout from '../layouts/Layout.astro';

// Načtení všech markdown souborů ze složky projects
const allProjects = await Astro.glob('../projects/*.md');

// Seřazení podle "order"
const projects = allProjects.sort((a, b) => a.frontmatter.order - b.frontmatter.order);
---

<Layout title="Moje Projekty">
	<h1>Moje Projekty</h1>
    <p>Vítejte. Tady odkládám věci, které jsem vytvořil, aby mi usnadnily život a zároveň abych se něco nového naučil.</p>
    <hr style="border-color: #333; margin: 2rem 0;">

    {projects.map((project) => (
        <div class="project-card">
            <h2>{project.frontmatter.title}</h2>
            <p><strong>{project.frontmatter.description}</strong></p>
            
            <div class="content-body">
                <project.Content />
            </div>

            {project.frontmatter.images && (
                <div class="gallery">
                    {project.frontmatter.images.map((img) => (
                        <div class="gallery-item">
                            <img src={img} alt="Náhled projektu" loading="lazy" />
                        </div>
                    ))}
                </div>
            )}
            
            {/* Záchrana pro staré projekty, kde máš pořád jen "image" */}
            {project.frontmatter.image && !project.frontmatter.images && (
                 <div class="gallery single">
                    <div class="gallery-item">
                        <img src={project.frontmatter.image} alt="Náhled projektu" loading="lazy" />
                    </div>
                </div>
            )}

            <div class="tech-stack">Technologie: {project.frontmatter.tech}</div>

            {/* Zobrazení tlačítka s odkazem (pokud existuje) */}
            {project.frontmatter.link && (
                <div class="links">
                    <a href={project.frontmatter.link} target="_blank" class="btn">
                        Podívat se na projekt →
                    </a>
                </div>
            )}

        </div>
    ))}
</Layout>

<style>
    .content-body {
        margin-top: 1rem;
        color: #b0b0b0;
    }
    .content-body :global(strong) {
        color: white;
    }
    .content-body :global(ul) {
        padding-left: 1.5rem;
    }

    /* Galerie - mřížka */
    .gallery {
        display: grid;
        grid-template-columns: 1fr 1fr; /* Dva sloupce vedle sebe */
        gap: 1rem; /* Mezera mezi obrázky */
        margin-top: 1.5rem;
        max-width: 800px; /* Celková šířka galerie */
        margin-left: auto;
        margin-right: auto;
    }

    /* Pokud je tam jen jeden obrázek (třída single), roztáhni ho */
    .gallery.single {
        grid-template-columns: 1fr;
        max-width: 600px;
    }

    .gallery-item {
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #333;
    }

    .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Zajistí, že obrázky budou stejně vysoké */
        display: block;
    }

    /* Na mobilu to chceme pod sebou, jinak budou prťavé */
    @media (max-width: 600px) {
        .gallery {
            grid-template-columns: 1fr; 
        }
    }

    /* Styly pro tlačítka */
    .links {
        margin-top: 1.5rem;
    }
    .btn {
        background: #333;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        text-decoration: none;
        font-weight: bold;
        border: 1px solid #555;
        transition: background 0.2s;
        display: inline-block;
    }
    .btn:hover {
        background: #555;
    }
</style>